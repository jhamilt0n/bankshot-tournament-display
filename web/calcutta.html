<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bankshot Calcutta</title>
    
    <!-- Google Fonts matching index.php -->
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald:wght@400;600;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        @font-face {
            font-family: 'libel';
            src: url('/libel-suit-rg.otf') format('opentype');
        }
        
        * {
            box-sizing: border-box;
        }
        
        /* Animated gradient background matching index.php */
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        body {
            font-family: 'Roboto', 'libel', Arial, sans-serif;
            color: #ffffff;
            text-align: center;
            margin: 0;
            padding: 20px;
            background: linear-gradient(180deg, #1e7e34, #0d4d1f, #1e7e34);
            background-size: 200% 200%;
            animation: gradientShift 10s ease infinite;
            min-height: 100vh;
        }
        
        .title-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        h1 {
            margin: 0;
            font-size: clamp(3rem, 8vw, 6rem);
            font-family: 'Bebas Neue', sans-serif;
            letter-spacing: 3px;
            color: #ffffff;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
        }
        
        .total-amount {
            font-size: clamp(2rem, 6vw, 4rem);
            font-family: 'Bebas Neue', sans-serif;
            color: #ffd700;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
            background: rgba(255, 215, 0, 0.2);
            padding: 10px 20px;
            border-radius: 10px;
            border: 3px solid rgba(255, 215, 0, 0.5);
            backdrop-filter: blur(5px);
        }
        
        .marquee-container {
            height: clamp(400px, 70vh, 800px);
            overflow: hidden;
            position: relative;
            border: 3px solid rgba(255, 255, 255, 0.3);
            margin: 0 auto;
            max-width: 1200px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
        }
        
        .table-header {
            flex-shrink: 0;
            background: linear-gradient(135deg, #1e7e34 0%, #0d5c26 100%);
            z-index: 10;
            border-radius: 12px 12px 0 0;
        }
        
        .table-header table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table-header th {
            padding: 15px 12px;
            text-align: left;
            color: white;
            font-weight: 700;
            font-size: clamp(1rem, 2vw, 1.5rem);
            border-bottom: 3px solid rgba(255, 255, 255, 0.3);
            font-family: 'Oswald', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .scroll-container {
            flex: 1;
            overflow: hidden;
            position: relative;
            background: rgba(255, 255, 255, 0.95);
        }
        
        .marquee-content {
            position: absolute;
            width: 100%;
            will-change: transform;
        }
        
        .marquee-content.scrolling {
            animation: scrollUp linear infinite;
        }
        
        .marquee-content table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .marquee-content td {
            padding: 12px 12px;
            text-align: left;
            border-bottom: 1px solid rgba(30, 126, 52, 0.2);
            font-size: clamp(1rem, 2vw, 1.3rem);
            background-color: rgba(255, 255, 255, 0.95);
            color: #0d4d1f;
            font-weight: 500;
        }
        
        .marquee-content tr:nth-child(even) td {
            background-color: rgba(240, 248, 242, 0.95);
        }
        
        .marquee-content tr:hover td {
            background-color: rgba(30, 126, 52, 0.15);
        }
        
        /* Highlight Amount column */
        .marquee-content td.amount {
            color: #1e7e34;
            font-weight: 700;
            font-family: 'Bebas Neue', sans-serif;
            font-size: clamp(1.2rem, 2.5vw, 1.8rem);
        }
        
        .loading {
            padding: 40px;
            font-size: 1.5rem;
            color: #ffffff;
            font-family: 'Oswald', sans-serif;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .error {
            padding: 40px;
            font-size: 1.5rem;
            color: #ff6b6b;
            font-family: 'Oswald', sans-serif;
            background: rgba(255, 0, 0, 0.2);
            border-radius: 10px;
            margin: 20px;
        }
        
        @keyframes scrollUp {
            0% {
                transform: translateY(0);
            }
            100% {
                transform: translateY(-50%);
            }
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            h1 {
                font-size: clamp(2rem, 10vw, 4rem);
            }
            
            .marquee-container {
                border-width: 2px;
            }
            
            .table-header th,
            .marquee-content td {
                padding: 10px 6px;
            }
        }
        
        @media (max-width: 480px) {
            .table-header th,
            .marquee-content td {
                padding: 8px 4px;
                font-size: 0.9rem;
            }
            
            .marquee-content td.amount {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="title-container">
        <h1>CALCUTTA</h1>
        <div class="total-amount" id="totalAmount">$0.00</div>
    </div>
    
    <div class="marquee-container">
        <div class="table-header" id="tableHeader">
            <!-- Fixed header will be added here -->
        </div>
        <div class="scroll-container">
            <div class="marquee-content" id="marqueeContent">
                <div class="loading">Loading auction data...</div>
            </div>
        </div>
    </div>
    
    <script>
        // ORIGINAL GOOGLE SHEETS URL - DO NOT CHANGE
        const webAppUrl = 'https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLjfanyvdZdlrr-AJVVNb9X2wZWkAVopbrOjFR8FKguQmJFtsOuhob8m94kCPfO6iLR6cjuYUNTlycQ3Qae1xJPwEci61XsavUZapb-LnEKFGdNg6krVK_-b-sXwAdV80Gu1d3MgDT3-ul2qP_4p3dC_aDtlY3Frf_KIx_AdnoocPC0-ngvc3nYqUYJNG0j7UA1qwsecNgLuf4Oqegjieq3NPn4asvp0nZmAS_0U9pNRAxjWbnz5NUkvQafaPtsBT_AHDsJxgNDRB_NYvFIFcwVQEnBm9g&lib=MPTwQbeDOLD3uQUtrbw_Q5tBpqG-IekUq';
        
        function formatCurrency(value) {
            // Remove any non-numeric characters except decimal point and minus
            const numValue = parseFloat(String(value).replace(/[^0-9.-]/g, ''));
            
            if (isNaN(numValue)) {
                return value;
            }
            
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(numValue);
        }
        
        function calculateTotal(data) {
            let total = 0;
            data.forEach(row => {
                // Look for the Amount column (case-insensitive)
                const amountKey = Object.keys(row).find(key => key.toLowerCase() === 'amount');
                if (amountKey) {
                    const value = parseFloat(String(row[amountKey]).replace(/[^0-9.-]/g, ''));
                    if (!isNaN(value)) {
                        total += value;
                    }
                }
            });
            return total;
        }
        
        function updateTotalDisplay(total) {
            const totalElement = document.getElementById('totalAmount');
            if (totalElement) {
                totalElement.textContent = formatCurrency(total);
            }
        }
        
        function createHeaderTable(headersArray) {
            const table = document.createElement('table');
            const thead = document.createElement('thead');
            
            // Create header row
            const headerRow = document.createElement('tr');
            headersArray.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                
                const headerLower = header.toLowerCase();
                if (headerLower === 'amount') {
                    th.style.textAlign = 'right';
                } else if (headerLower === 'name' || headerLower === 'buyer') {
                    th.style.textAlign = 'left';
                }
                
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            return table;
        }
        
        function createBodyTable(data, headersArray) {
            const table = document.createElement('table');
            const tbody = document.createElement('tbody');
            
            // Create data rows (no headers)
            data.forEach(rowData => {
                const tr = document.createElement('tr');
                headersArray.forEach(header => {
                    const td = document.createElement('td');
                    const value = rowData[header];
                    
                    const headerLower = header.toLowerCase();
                    
                    // Format currency for Amount column
                    if (headerLower === 'amount') {
                        td.textContent = formatCurrency(value);
                        td.classList.add('amount');
                        td.style.textAlign = 'right';
                    } else {
                        td.textContent = value;
                        // Explicitly set left alignment for Name and Buyer
                        if (headerLower === 'name' || headerLower === 'buyer') {
                            td.style.textAlign = 'left';
                        }
                    }
                    
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
            
            table.appendChild(tbody);
            return table;
        }
        
        function calculateAnimationDuration(contentHeight, containerHeight) {
            // Base speed: 50 pixels per second
            const pixelsPerSecond = 50;
            // Calculate duration based on content height
            const duration = contentHeight / pixelsPerSecond;
            // Minimum 10 seconds, maximum 120 seconds
            return Math.max(10, Math.min(120, duration));
        }
        
        function startMarquee() {
            const marqueeContent = document.getElementById('marqueeContent');
            const container = marqueeContent.parentElement;
            
            // Wait for next frame to ensure content is rendered
            requestAnimationFrame(() => {
                const contentHeight = marqueeContent.scrollHeight;
                const containerHeight = container.clientHeight;
                
                // Calculate dynamic animation duration
                const duration = calculateAnimationDuration(contentHeight / 2, containerHeight);
                
                // Set the animation duration
                marqueeContent.style.animationDuration = `${duration}s`;
                
                // Start the animation
                marqueeContent.classList.add('scrolling');
            });
        }
        
        fetch(webAppUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                const marqueeContent = document.getElementById('marqueeContent');
                const tableHeader = document.getElementById('tableHeader');
                
                if (!data || data.length === 0) {
                    marqueeContent.innerHTML = '<div class="error">No data available</div>';
                    return;
                }
                
                // Calculate and update total
                const total = calculateTotal(data);
                updateTotalDisplay(total);
                
                // Get headers from first row
                const headers = Object.keys(data[0]);
                
                // Create fixed header
                const headerTable = createHeaderTable(headers);
                tableHeader.appendChild(headerTable);
                
                // Clear loading message
                marqueeContent.innerHTML = '';
                
                // Create first table (body only)
                const table1 = createBodyTable(data, headers);
                marqueeContent.appendChild(table1);
                
                // Create duplicate table for seamless scrolling (body only)
                const table2 = createBodyTable(data, headers);
                marqueeContent.appendChild(table2);
                
                // Start the marquee animation
                startMarquee();
            })
            .catch(error => {
                console.error('Error fetching data:', error);
                const marqueeContent = document.getElementById('marqueeContent');
                marqueeContent.innerHTML = '<div class="error">Error loading data. Please try again later.</div>';
            });
        
        // Recalculate animation on window resize
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                const marqueeContent = document.getElementById('marqueeContent');
                if (marqueeContent.classList.contains('scrolling')) {
                    marqueeContent.classList.remove('scrolling');
                    // Force reflow
                    void marqueeContent.offsetWidth;
                    startMarquee();
                }
            }, 250);
        });
    </script>
</body>
</html>